<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>æ˜¯ã€Œä¹Ÿã€çš„æ­å·åœ°å›¾</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    html, body, #map { height: 100%; margin: 0; padding: 0; }
    .amap-info-content { font-size: 14px; }
    .legend {
      position: absolute;
      top: 10px;
      left: 10px;
      background: rgba(255,255,255,0.9);
      border-radius: 6px;
      padding: 10px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.15);
      z-index: 1000;
    }
    .legend-item { display: flex; align-items: center; margin-bottom: 6px; }
    .legend-icon { width: 20px; height: 20px; margin-right: 6px; }
    .marker-label {
      font-size: 16px;
      color: #fff;
      background: rgba(34,34,34,0.75);
      border-radius: 6px;
      padding: 2px 10px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.15);
      white-space: nowrap;
      transition: background 0.2s;
      border: none;
    }
    .marker-label-hover {
      background: rgba(34,34,34,0.95);
      color: #ffe58f;
      border: none;
    }
    /* å¼ºåˆ¶è¦†ç›–é«˜å¾·åœ°å›¾labelçš„è“è‰²è¾¹æ¡†å’ŒèƒŒæ™¯ */
    .amap-marker-label {
      border: none !important;
      box-shadow: none !important;
      background: none !important;
      padding: 0 !important;
    }
    .filter-panel {
      position: absolute;
      top: 40px;
      right: 20px;
      width: 220px;
      background: rgba(255,255,255,0.97);
      border-radius: 10px;
      box-shadow: 0 2px 16px rgba(0,0,0,0.13);
      padding: 18px 18px 12px 18px;
      z-index: 1200;
      font-family: 'PingFang SC', 'Microsoft YaHei', Arial, sans-serif;
      font-size: 15px;
      color: #222;
      transition: box-shadow 0.2s;
      max-height: 600px;
      overflow-y: auto;
    }
    .filter-title {
      font-size: 18px;
      font-weight: bold;
      margin-bottom: 12px;
      letter-spacing: 2px;
    }
    .filter-section { margin-bottom: 14px; }
    .filter-label { font-size: 14px; margin-bottom: 6px; color: #666; }
    .filter-recommend label, .filter-category label {
      display: inline-block;
      margin-right: 10px;
      margin-bottom: 6px;
      cursor: pointer;
      font-size: 14px;
    }
    .filter-category {
      max-height: 280px;
      overflow-y: auto;
      border-radius: 6px;
      background: #f7f7f7;
      padding: 6px 4px 4px 8px;
      border: 1px solid #eee;
    }
    .filter-category label { width: 120px; }
    .filter-panel input[type="checkbox"] {
      accent-color: #1890ff;
      margin-right: 3px;
      vertical-align: middle;
    }
  </style>
  <!-- é«˜å¾·åœ°å›¾ JS API -->
  <script src="https://webapi.amap.com/maps?v=2.0&key=42d488ef7932b3161e71b17935f660a3"></script>
</head>
<body>
  <div id="map"></div>
  <div class="legend" id="legend"></div>
  <div id="filter-panel" class="filter-panel">
    <div class="filter-title">æ­å·ç¾é£ŸæŒ‡å—</div>
    <div class="filter-section">
      <div class="filter-label">æ¨èæŒ‡æ•°</div>
      <div class="filter-recommend">
        <label><input type="checkbox" name="recommend" value="5"> 5æ˜Ÿ</label>
        <label><input type="checkbox" name="recommend" value="4"> 4æ˜Ÿ</label>
        <label><input type="checkbox" name="recommend" value="3"> 3æ˜Ÿ</label>
        <label><input type="checkbox" name="recommend" value="2"> 2æ˜Ÿ</label>
        <label><input type="checkbox" name="recommend" value="1"> 1æ˜Ÿ</label>
      </div>
    </div>
    <div class="filter-section">
      <div class="filter-label">é¤å…ç±»åˆ«</div>
      <div class="filter-category" id="filter-category-list"></div>
    </div>
  </div>
  <script>
    // é¤å…æ•°æ®ç›´æ¥åµŒå…¥
    const data =  [
  {
    "name": "å¦‚é™¢é¤å…",
    "type": "ä¸­é¤å…",
    "location": "120.122175,30.253356",
    "address": "ç‰æ³‰è·¯11å·",
    "photo": "http://store.is.autonavi.com/showpic/b08795ab6adeba25a0115d74130862aa",
    "cost": "",
    "open_time": "11:30-14:00 17:30-21:00",
    "rating": "4.7",
    "phone": "",
    "advantage": "ç”¨é¤æœåŠ¡åˆ°ä½ï¼Œèœå“æ–°æ„å¤§ï¼Œæ¨èé±¼åœ†ã€é»„é…’é¹…è‚ç‰›å°æ’ã€æ³•è‘±è—œéº¦èƒèŸ¹ã€‚æ™¯è§‚ä½æ—¥å¼ä¸‹æ²‰åº§ä½ã€‚",
    "recommend_index": "5",
    "category": "ä¸­é¤"
  },
  {
    "name": "æ­å·è¥¿å­æ¹–å››å­£é…’åº—é‡‘æ²™å…",
    "type": "æµ™æ±Ÿèœ",
    "location": "120.129637,30.251887",
    "address": "çµéšè·¯5å·æ­å·è¥¿å­æ¹–å››å­£é…’åº—1å±‚(è¿‘æ›²é™¢é£è·)",
    "photo": "http://store.is.autonavi.com/showpic/03f435393b04359460529d3cc484e826",
    "cost": "533.00",
    "open_time": "11:30-14:00 17:30-21:00",
    "rating": "4.8",
    "phone": "",
    "advantage": "å‡ºå“æœ‰æ°´å‡†ï¼Œæ—¶ä»¤èœé£å‘³æ›´å¥½ï¼Œè„†çš®é¸¡å’Œç‰›ç‚’é¥­ä¹Ÿä¸é”™ã€‚",
    "recommend_index": "5",
    "category": "æ­å¸®èœ/æµ™æ±Ÿèœ"
  },
  {
    "name": "é—¨æ²¡é”å’–å•¡é¦†",
    "type": "å’–å•¡é¦†",
    "location": "120.099355,30.297518",
    "address": "æ”¿ç´«å¼„23å¹¢103å·æ²¿è¡—(ä¸‰ååœ°é“ç«™Få£æ­¥è¡Œ210ç±³)",
    "photo": "https://aos-comment.amap.com/B0KUPD8084/comment/A241830B_F0B4_4496_A253_95A1F5385C51_L0_001_1500_2000_1735672012627_76019873.jpg",
    "cost": "",
    "open_time": "10:00-17:00",
    "rating": "4.3",
    "phone": "",
    "advantage": "æ–‡è‰ºæ°›å›´æµ“åšï¼Œç”œå“å¥½åƒã€‚",
    "recommend_index": "4",
    "category": "å’–å•¡é¦†"
  },
  {
    "name": "helloworld",
    "type": "å’–å•¡é¦†",
    "location": "120.005480,30.280547",
    "address": "æ¬§ç¾é‡‘èåŸè¥¿æºªä¸½æ™¶å±…1å¹¢åº•å•†1-13å·",
    "photo": "http://store.is.autonavi.com/showpic/72efe174477c732d4264f7373dfaf768",
    "cost": "30.00",
    "open_time": "08:00-18:00",
    "rating": "4.3",
    "phone": "",
    "advantage": "EFCï¼Œåº—é‡Œé€‚åˆæ‰“å·¥åŠ ç­",
    "recommend_index": "4",
    "category": "å’–å•¡é¦†"
  },
  {
    "name": "å¤©åœ°æ ‹å®‡",
    "type": "å·èœ",
    "location": "120.161176,30.334402",
    "address": "secret",
    "photo": "https://i.postimg.cc/ZR8Kk7pP/61749807646-pic.jpg",
    "cost": "120",
    "open_time": "ä¸€èˆ¬å‘¨æœ«14:00-18:00",
    "rating": "50",
    "phone": "",
    "advantage": "æ¢¦å¼€å§‹çš„åœ°æ–¹",
    "recommend_index": "5",
    "category": "ä½ çŒœ"
  }
];
    // å›¾æ ‡æ˜ å°„è¡¨ï¼ŒæŒ‰æœ€æ–°icon.txt
    const typeIcons = {
      'è¾£æ¤’': 'https://gw.alicdn.com/imgextra/i4/O1CN01ivxrXs1FmmyaA3Pf8_!!6000000000530-2-tps-64-64.png',
      'ç”œç‚¹': 'https://gw.alicdn.com/imgextra/i1/O1CN01pegPN21rDwEsbUl8e_!!6000000005598-2-tps-64-64.png',
      'å’–å•¡': 'https://gw.alicdn.com/imgextra/i2/O1CN01ni8Yv51mLCRK8svZQ_!!6000000004937-2-tps-64-64.png',
      'ä¸­é¤': 'https://gw.alicdn.com/imgextra/i1/O1CN01vk7HHX1xnYjp5MytB_!!6000000006488-2-tps-64-64.png',
      'æ—¥æ–™': 'https://gw.alicdn.com/imgextra/i1/O1CN01RPhYzA1zVocnuSJB4_!!6000000006720-2-tps-64-64.png',
      'å¿«é¤': 'https://gw.alicdn.com/imgextra/i1/O1CN01KuB8bM1Ylqroiyhld_!!6000000003100-2-tps-64-64.png',
      'çƒ¤è‚‰': 'https://gw.alicdn.com/imgextra/i2/O1CN01w9GzQK1KFsb5WZ1KU_!!6000000001135-2-tps-50-50.png',
      'çƒ§çƒ¤': 'https://gw.alicdn.com/imgextra/i2/O1CN01U64EIT28WZpDfG2Xg_!!6000000007940-2-tps-64-64.png',
      'æ˜Ÿæ˜Ÿ': 'https://gw.alicdn.com/imgextra/i2/O1CN014DVQlb1oVqsnsrbiT_!!6000000005231-2-tps-64-64.png',
      'ç«é”…': 'https://gw.alicdn.com/imgextra/i2/O1CN01PqUeaR25xBzjCsm6C_!!6000000007592-2-tps-64-64.png',
      'ç‰›æ’': 'https://gw.alicdn.com/imgextra/i1/O1CN01AS3frX1H3Z6M03qyd_!!6000000000702-2-tps-64-64.png',
      'é¢é£Ÿ': 'https://gw.alicdn.com/imgextra/i1/O1CN01dv4ZEI1VBim6m6PDr_!!6000000002615-2-tps-64-64.png',
      'æµ·é²œ': 'https://gw.alicdn.com/imgextra/i1/O1CN01eIQVxn22UOEuX0Knj_!!6000000007123-2-tps-64-64.png',
      'éŸ©é¤': 'https://gw.alicdn.com/imgextra/i3/O1CN01JdoaM71rGEDgJvPV5_!!6000000005603-2-tps-108-64.png',
      'å°åƒ': 'https://gw.alicdn.com/imgextra/i4/O1CN01iUcUR51i7gHoCyAX0_!!6000000004366-2-tps-64-64.png',
      'ç²¤èœ': 'https://gw.alicdn.com/imgextra/i2/O1CN01Rmp0Bf29J7oAaAi6m_!!6000000008046-2-tps-73-64.png',
      'default': 'https://gw.alicdn.com/imgextra/i2/O1CN014DVQlb1oVqsnsrbiT_!!6000000005231-2-tps-64-64.png'
    };
    // å›¾ä¾‹åˆ†ç±»ï¼ŒæŒ‰icon.txté¡ºåº
    const legendTypes = [
      {type: 'ä¸­é¤', label: 'ä¸­é¤/æ­å¸®èœ/å…¶ä»–'},
      {type: 'ç²¤èœ', label: 'ç²¤èœ'},
      {type: 'è¾£æ¤’', label: 'å·èœ'},
      {type: 'ç«é”…', label: 'ç«é”…'},
      {type: 'çƒ§çƒ¤', label: 'çƒ§çƒ¤'},
      {type: 'çƒ¤è‚‰', label: 'çƒ¤è‚‰'},
      {type: 'æ—¥æ–™', label: 'æ—¥æ–™'},
      {type: 'éŸ©é¤', label: 'éŸ©é¤'},
      {type: 'ç‰›æ’', label: 'è¥¿é¤'},
      {type: 'é¢é£Ÿ', label: 'é¢é¦†/é¢é£Ÿ'},
      {type: 'å°åƒ', label: 'å°åƒ'},
      {type: 'ç”œç‚¹', label: 'ç”œå“/é¥®å“'},
      {type: 'å’–å•¡', label: 'å’–å•¡é¦†'},
      {type: 'å¿«é¤', label: 'å¿«é¤'},
      {type: 'æµ·é²œ', label: 'æµ·é²œ'}
    ];
    // categoryåˆ°iconçš„æ˜ å°„è§„åˆ™
    function getCategoryIcon(category) {
      if (!category) return typeIcons['default'];
      if (category === 'ä¸­é¤' || category === 'æ­å¸®èœ/æµ™æ±Ÿèœ' || category === 'æ¹˜èœ' || category === 'ä¸œåŒ—èœ' || category === 'ç´ é£Ÿ' || category === 'ç§æˆ¿èœ') return typeIcons['ä¸­é¤'];
      if (category === 'ç²¤èœ') return typeIcons['ç²¤èœ'];
      if (category === 'å·èœ') return typeIcons['è¾£æ¤’'];
      if (category === 'ç«é”…') return typeIcons['ç«é”…'];
      if (category === 'çƒ§çƒ¤/çƒ¤è‚‰') return typeIcons['çƒ¤è‚‰'];
      if (category === 'çƒ§çƒ¤') return typeIcons['çƒ§çƒ¤'];
      if (category === 'æ—¥æ–™') return typeIcons['æ—¥æ–™'];
      if (category === 'éŸ©é¤') return typeIcons['éŸ©é¤'];
      if (category === 'è¥¿é¤') return typeIcons['ç‰›æ’'];
      if (category === 'é¢é¦†') return typeIcons['é¢é£Ÿ'];
      if (category === 'å°åƒ') return typeIcons['å°åƒ'];
      if (category === 'ç”œå“/é¥®å“') return typeIcons['ç”œç‚¹'];
      if (category === 'å’–å•¡é¦†') return typeIcons['å’–å•¡'];
      if (category === 'å¿«é¤') return typeIcons['å¿«é¤'];
      if (category === 'æµ·é²œ') return typeIcons['æµ·é²œ'];
      return typeIcons['default'];
    }
    
    // åˆå§‹åŒ–åœ°å›¾
    const map = new AMap.Map('map', {
      center: [120.15507, 30.274085], // æ­å·ä¸­å¿ƒ
      zoom: 12
    });
    // ç§»é™¤æ‰€æœ‰ data.forEach(...) ç›¸å…³çš„markeræ¸²æŸ“ï¼Œåªä¿ç•™ renderMarkers() æ§åˆ¶
    // ... existing code ...
    // å›¾ä¾‹æ¸²æŸ“
    const legend = document.getElementById('legend');
    legend.innerHTML = legendTypes.map(t =>
      `<div class="legend-item"><img class='legend-icon' src='${typeIcons[t.type]}' alt='${t.label}' />${t.label}</div>`
    ).join('');
    // InfoWindowå…¨å±€å˜é‡
    let infoWindow = null;
    // labelæ ·å¼
    const style = document.createElement('style');
    style.innerHTML = `
      .marker-label {
        font-size: 16px;
        color: #fff;
        background: rgba(34,34,34,0.75);
        border-radius: 6px;
        padding: 2px 10px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.15);
        white-space: nowrap;
        transition: background 0.2s;
        border: none;
      }
      .marker-label-hover {
        background: rgba(34,34,34,0.95);
        color: #ffe58f;
        border: none;
      }
      /* å¼ºåˆ¶è¦†ç›–é«˜å¾·åœ°å›¾labelçš„è“è‰²è¾¹æ¡†å’ŒèƒŒæ™¯ */
      .amap-marker-label {
        border: none !important;
        box-shadow: none !important;
        background: none !important;
        padding: 0 !important;
      }
    `;
    document.head.appendChild(style);
    // åŠ¨æ€ç”Ÿæˆç±»åˆ«ç­›é€‰é¡¹
    const allCategories = Array.from(new Set(data.map(d => d.category).filter(Boolean)));
    const filterCategoryList = document.getElementById('filter-category-list');
    filterCategoryList.innerHTML = allCategories.map(cat =>
      `<label><input type='checkbox' name='category' value='${cat}'> ${cat}</label>`
    ).join('');
    // é»˜è®¤å‹¾é€‰5æ˜Ÿ
    document.querySelector('input[name="recommend"][value="5"]').checked = true;

    // ç­›é€‰é€»è¾‘
    function getSelectedRecommends() {
      return Array.from(document.querySelectorAll('input[name="recommend"]:checked')).map(i => i.value);
    }
    function getSelectedCategories() {
      return Array.from(document.querySelectorAll('input[name="category"]:checked')).map(i => i.value);
    }
    let allMarkers = [];
    function renderMarkers() {
      // æ¸…é™¤æ—§marker
      allMarkers.forEach(m => m.setMap(null));
      allMarkers = [];
      const selectedRecommends = getSelectedRecommends();
      const selectedCategories = getSelectedCategories();
      let filtered = data;
      // å–äº¤é›†ç­–ç•¥ï¼šéƒ½é€‰äº†æ‰å±•ç¤º
      if (selectedRecommends.length) {
        filtered = filtered.filter(d => selectedRecommends.includes(d.recommend_index));
      }
      if (selectedCategories.length) {
        filtered = filtered.filter(d => selectedCategories.includes(d.category));
      }
      // å¦‚æœéƒ½æ²¡é€‰ï¼Œå±•ç¤ºå…¨éƒ¨
      if (!selectedRecommends.length && !selectedCategories.length) {
        filtered = data;
      }
      filtered.forEach(item => {
        if (!item.location) return;
        const [lng, lat] = item.location.split(',').map(Number);
        const iconUrl = getCategoryIcon(item.category);
        const marker = new AMap.Marker({
          position: [lng, lat],
          icon: new AMap.Icon({
            image: iconUrl,
            size: new AMap.Size(32, 32),
            imageSize: new AMap.Size(32, 32)
          }),
          title: item.name,
          offset: new AMap.Pixel(-16, -36),
          label: {
            content: `<span class='marker-label'>${item.name}</span>`,
            direction: 'top',
            offset: new AMap.Pixel(0, -16),
            clickable: true
          }
        });
        marker.on('mouseover', () => marker.setLabel({ ...marker.getLabel(), content: `<span class='marker-label marker-label-hover'>${item.name}</span>` }));
        marker.on('mouseout', () => marker.setLabel({ ...marker.getLabel(), content: `<span class='marker-label'>${item.name}</span>` }));
        marker.on('click', () => showInfo(item));
        marker.on('labelClick', () => showInfo(item));
        marker.setMap(map);
        allMarkers.push(marker);
      });
    }
    // ç›‘å¬ç­›é€‰é¡¹å˜åŒ–
    document.querySelectorAll('.filter-panel input[type="checkbox"]').forEach(input => {
      input.addEventListener('change', renderMarkers);
    });
    // åˆå§‹åŒ–æ—¶æ¸²æŸ“ä¸€æ¬¡
    renderMarkers();

    function showInfo(item) {
      // å…³é—­å·²æœ‰ infoWindow
      if (infoWindow) {
        infoWindow.close();
      }
      // æ„å»ºè¯¦æƒ…å†…å®¹
      const content = `
        <div style="min-width:220px;max-width:320px;">
          <div style="font-size:18px;font-weight:bold;margin-bottom:6px;">${item.name}</div>
          <div style="margin-bottom:4px;">${item.address ? 'ğŸ“ ' + item.address : ''}</div>
          ${item.photo ? `<img src="${item.photo}" style="width:100%;max-height:120px;object-fit:cover;border-radius:6px;margin-bottom:6px;">` : ''}
          <div>ç±»å‹ï¼š${item.category || item.type || ''}</div>
          <div>æ¨èæŒ‡æ•°ï¼š${item.recommend_index || ''}</div>
          <div>è¯„åˆ†ï¼š${item.rating || ''}</div>
          <div>äººå‡ï¼š${item.cost ? 'ï¿¥' + item.cost : ''}</div>
          <div>è¥ä¸šæ—¶é—´ï¼š${item.open_time || ''}</div>
          <div>ç”µè¯ï¼š${item.phone || ''}</div>
          <div style="margin-top:4px;">${item.advantage || ''}</div>
        </div>
      `;
      // å–åæ ‡
      const [lng, lat] = item.location.split(',').map(Number);
      infoWindow = new AMap.InfoWindow({
        content,
        offset: new AMap.Pixel(0, -36)
      });
      infoWindow.open(map, [lng, lat]);
    }

    // ç‚¹å‡»åœ°å›¾ç©ºç™½å¤„å…³é—­è¯¦æƒ…å¼¹çª—
    map.on('click', function() {
      if (infoWindow) infoWindow.close();
    });
  </script>
</body>
</html> 
